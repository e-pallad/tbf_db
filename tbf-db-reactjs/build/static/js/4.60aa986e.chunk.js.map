{"version":3,"sources":["eingabe/Table.js"],"names":["pushDataToDb","pushData","table","a","formData","FormData","append","JSON","stringify","config","method","body","fetch","result","ok","Error","statusText","console","log","Table","props","onGridReady","params","gridApi","api","gridColumnApi","columnApi","allColumnIds","getAllColumns","forEach","column","push","colId","autoSizeColumns","state","editType","defaultColDef","sortable","editable","filter","resizable","bind","dataChanged","getMaxTBFID","onAddRow","then","res","json","setState","maxTBFID","parseInt","error","this","applyTransaction","add","TBF_ID","data","fetchMskValues","response","match","find","msk","button","tableData","columns","slice","map","header","cellEditor","cellEditorParams","headerName","field","refData","className","onClick","id","style","height","width","columnDefs","rowData","pagination","suppressFieldDotNotation","onRowValueChanged","Component"],"mappings":"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","file":"static/js/4.60aa986e.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport { AgGridReact } from 'ag-grid-react';\nimport './table.css';\n\nimport 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-alpine.css';\n\nasync function pushDataToDb(pushData, table) {\n\n    const url = 'https://tbf-db-backend.ep-webdesign.de/updateTable.php';\n\n    const formData = new FormData();  \n    formData.append('table', table); \n    formData.append('data', JSON.stringify(pushData));  \n\n    const config = { \n        method: 'POST',\n        body: formData\n    };\n    try {\n        const result = await fetch(url, config)\n        if (!result.ok) {\n            throw Error(result.statusText);\n        } else {\n            return result\n        }\n    } catch (error) {\n        console.log(error)\n    }\n\n}\n\nexport default class Table extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            editType: 'fullRow',\n            defaultColDef: {\n                sortable: true,\n                editable: true,\n                filter: true,\n                resizable: true,\n            },\n            table: this.props.table\n        }\n        this.onGridReady = this.onGridReady.bind(this);\n        this.dataChanged = this.dataChanged.bind(this);\n        this.getMaxTBFID = this.getMaxTBFID.bind(this);\n        this.onAddRow = this.onAddRow.bind(this);\n    }\n\n    async getMaxTBFID() {\n        return fetch('https://tbf-db-backend.ep-webdesign.de/getMaxTBFID.php')\n        .then(res => res.json())\n        .then(\n            (result) => {\n                this.setState({\n                    maxTBFID: parseInt(result),\n                });\n            },\n            (error) => {\n                this.setState({\n                    error\n                });\n            }   \n        )\n    }\n\n    async onAddRow() {\n        if (!this.state.maxTBFID) {\n            await this.getMaxTBFID()\n        } \n        \n        this.setState({ maxTBFID: this.state.maxTBFID + 1}, () => {\n            console.log(this.state.maxTBFID)\n            this.gridApi.applyTransaction({\n                add: [{TBF_ID: this.state.maxTBFID}],\n            })\n        })\n        \n    }\n\n    onGridReady = params => {\n        this.gridApi = params.api;\n        this.gridColumnApi = params.columnApi;\n\n        var allColumnIds = [];\n        this.gridColumnApi.getAllColumns().forEach(function(column) {\n            allColumnIds.push(column.colId);\n        });\n        //params.columnApi.autoSizeColumns(allColumnIds, true)\n        params.columnApi.autoSizeColumns(allColumnIds)\n        //params.api.sizeColumnsToFit();\n        //params.gridApi.autoSizeColumns(true)\n    };\n\n    dataChanged(data) {\n        if (this.state.table === \"RI-TBF_SEF_Elektroangaben\") {\n\n            console.log(data.data);\n\n            async function fetchMskValues() {\n                const response = await fetch('https://tbf-db-backend.ep-webdesign.de/getTypicalMskValues.php')\n                const result = await response.json()\n                return result\n            }\n\n            fetchMskValues().then(result => {\n                    var match = result.find(msk => msk[0] === data.data[\"Typical Nr. MSK\"])\n                    if (match) {\n                        data.data[\"Anzahl AI\"] = parseInt(match[4])\n                        data.data[\"Anzahl AO\"] = parseInt(match[5])\n                        data.data[\"Anzahl DI\"] = parseInt(match[2])\n                        data.data[\"Anzahl DO\"] = parseInt(match[3])\n                    } else {\n                        data.data[\"Anzahl AI\"] = null\n                        data.data[\"Anzahl AO\"] = null\n                        data.data[\"Anzahl DI\"] = null\n                        data.data[\"Anzahl DO\"] = null\n                    }\n                    pushDataToDb(data.data, this.state.table)\n                }\n            )\n        } else {\n            pushDataToDb(data.data, this.state.table)\n        }\n    }\n\n    render() {\n        const { tableData } = this.props\n        const { table } = this.state\n        let button;\n\n        const columns = tableData.slice(0,1).map(( header ) => {\n            return(\n                header.map(( column ) => {\n                    if (column.cellEditor && column.cellEditorParams) {\n                        return({\n                            headerName: column.headerName,\n                            field: column.field,\n                            editable: column.editable,\n                            cellEditor: column.cellEditor,\n                            cellEditorParams: column.cellEditorParams,\n                            refData: column.refData,\n                        })\n                    } else {\n                        return({\n                            headerName: column.headerName,\n                            field: column.field,\n                            editable: column.editable,\n                        })\n                    }\n                })\n            )\n        })  \n        \n        const data = tableData.slice(1)\n\n        if (table === 'RI-TBF_SEF_Elektrokomponentenliste') {\n            button = <button className=\"btn btn-outline-success mb-2\" onClick={this.onAddRow}>Zeile hinzuf√ºgen</button>\n        } else {\n            button = null\n        }\n        \n        return (\n            <div id=\"grid\" className=\"p-0 overflow-hidden w-100 h-100\">\n                <nav className=\"navbar navbar-light bg-light\">\n                    <h2 className=\"navbar-brand\">{table}</h2>\n                    {button}\n                </nav>\n                <div className=\"ag-theme-alpine\" style={ { height: 'calc(100% - 60px)', width: '100%'} }>\n                    <AgGridReact\n                        columnDefs={columns[0]}\n                        \n                        defaultColDef={this.state.defaultColDef}\n                        rowData={data}\n\n                        editType={this.state.editType}\n                        pagination={true}\n                        //stopEditingWhenGridLosesFocus={true}\n                        suppressFieldDotNotation={true}\n                        \n                        onRowValueChanged={this.dataChanged}\n                        onGridReady={this.onGridReady}\n                        />\n                </div>\n            </div>\n        );\n    }\n  }"],"sourceRoot":""}